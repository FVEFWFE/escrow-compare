"use strict";(()=>{var e={};e.id=84,e.ids=[84],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},41808:e=>{e.exports=require("net")},71576:e=>{e.exports=require("string_decoder")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},7287:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{GET:()=>d});var i=t(49303),o=t(88716),n=t(60670),a=t(87070),c=t(83493),u=t(93475),p=t(21067);let l=p.Ry({limit:p.oQ.number().min(1).max(100).default(20),offset:p.oQ.number().min(0).default(0),sortBy:p.Km(["trustScore","name","fees","responseTime","foundedYear"]).default("trustScore"),order:p.Km(["asc","desc"]).default("desc"),minTrustScore:p.oQ.number().min(0).max(100).optional(),cryptoSupported:p.oQ.boolean().optional(),instantTransfer:p.oQ.boolean().optional(),search:p.Z_().optional(),filter:p.Km(["top-rated","crypto","business","international"]).optional()});async function d(e){try{let{searchParams:r}=new URL(e.url),t=l.parse(Object.fromEntries(r)),s=`services:${JSON.stringify(t)}`,i=await (0,u.se)(s);if(i)return a.NextResponse.json(i);let o={};if(t.minTrustScore&&(o.trustScore={gte:t.minTrustScore}),void 0!==t.cryptoSupported&&(o.cryptoSupported=t.cryptoSupported),void 0!==t.instantTransfer&&(o.instantTransfer=t.instantTransfer),t.search&&(o.OR=[{name:{contains:t.search,mode:"insensitive"}},{description:{contains:t.search,mode:"insensitive"}},{headquarters:{contains:t.search,mode:"insensitive"}}]),t.filter)switch(t.filter){case"top-rated":o.trustScore={gte:90};break;case"crypto":o.cryptoSupported=!0;break;case"business":o.minTransaction={gte:1e3},o.apiAvailable=!0;break;case"international":o.jurisdictions={hasSome:["USA","EU","UK","Asia"]}}let[n,p]=await Promise.all([c._.escrowService.findMany({where:o,orderBy:{[t.sortBy]:t.order},take:t.limit,skip:t.offset,include:{reviews:{select:{rating:!0}},metrics:{orderBy:{timestamp:"desc"},take:1}}}),c._.escrowService.count({where:o})]),d={services:n.map(e=>({...e,avgRating:e.reviews.length?e.reviews.reduce((e,r)=>e+r.rating,0)/e.reviews.length:0,reviewCount:e.reviews.length,currentMetrics:e.metrics[0]||null})),total:p,limit:t.limit,offset:t.offset,hasMore:t.offset+t.limit<p};return await (0,u.E6)(s,d,60),a.NextResponse.json(d)}catch(e){return console.error("Error fetching services:",e),a.NextResponse.json({error:"Failed to fetch services"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/services/route",pathname:"/api/services",filename:"route",bundlePath:"app/api/services/route"},resolvedPagePath:"/workspace/escrow-compare/app/api/services/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:h}=m,g="/api/services/route";function y(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},83493:(e,r,t)=>{t.d(r,{_:()=>i});let s=require("@prisma/client"),i=globalThis.prisma??new s.PrismaClient},93475:(e,r,t)=>{t.d(r,{E6:()=>o,se:()=>i});let s=(0,t(79984).createClient)({url:process.env.REDIS_URL||"redis://localhost:6379"});async function i(e){try{let r=await s.get(e);return r?JSON.parse(r):null}catch(r){return console.error(`Error getting cached data for ${e}:`,r),null}}async function o(e,r,t=60){try{await s.setEx(e,t,JSON.stringify(r))}catch(r){console.error(`Error setting cached data for ${e}:`,r)}}s.on("error",e=>console.error("Redis Client Error",e)),s.isOpen||s.connect().catch(console.error)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,984,67],()=>t(7287));module.exports=s})();