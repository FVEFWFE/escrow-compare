"use strict";(()=>{var e={};e.id=736,e.ids=[736],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72955:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{POST:()=>d});var n=a(49303),o=a(88716),s=a(60670),i=a(87070),c=a(83493),u=a(21067);let p=u.Ry({amount:u.Rx().min(0),currency:u.Z_().default("USD"),transactionType:u.Km(["standard","international","crypto","business"]).default("standard"),fromCountry:u.Z_().optional(),toCountry:u.Z_().optional(),serviceIds:u.IX(u.Z_()).optional()}),l={USD:1,EUR:.92,GBP:.79,BTC:24e-6,ETH:39e-5,CAD:1.36,AUD:1.53,JPY:149.5};async function d(e){try{let t=await e.json(),a=p.parse(t),r=a.amount/(l[a.currency]||1),n=a.serviceIds?.length?{id:{in:a.serviceIds}}:{},o=await c._.escrowService.findMany({where:n,take:a.serviceIds?.length||10,orderBy:{trustScore:"desc"}}),s=o.map(e=>{let t=e.fees,n=0,o=0,s=0,i=t.buyer||t.standard||{percentage:3,min:25};switch(a.transactionType){case"international":n=1.2*(i.percentage||3),o=1.5*(i.min||25);break;case"crypto":e.cryptoSupported?(n=.8*(i.percentage||3),o=.8*(i.min||25)):(n=1.5*(i.percentage||3),o=1.5*(i.min||25));break;case"business":n=.9*(i.percentage||3),o=i.min||25;break;default:n=i.percentage||3,o=i.min||25}let c=r*n/100;s=Math.max(c,o),i.max&&(s=Math.min(s,i.max));let u=r>=e.minTransaction&&(!e.maxTransaction||r<=e.maxTransaction);return{serviceId:e.id,serviceName:e.name,serviceSlug:e.slug,trustScore:e.trustScore,percentageFee:n,fixedFee:o,totalFee:Math.round(100*s)/100,totalFeeInCurrency:Math.round(s*(l[a.currency]||1)*100)/100,currency:a.currency,isAvailable:u,features:{instantTransfer:e.instantTransfer,cryptoSupported:e.cryptoSupported,apiAvailable:e.apiAvailable},responseTime:e.avgResponseTime}});s.sort((e,t)=>e.totalFee-t.totalFee);let u=Math.max(...s.map(e=>e.totalFee)),d=s.map(e=>({...e,savings:Math.round((u-e.totalFee)*100)/100,savingsPercentage:Math.round((u-e.totalFee)/u*100)}));return await c._.feeCalculation.create({data:{amount:r,currency:a.currency,serviceIds:o.map(e=>e.id),fromCountry:a.fromCountry,toCountry:a.toCountry,transactionType:a.transactionType,results:d}}),i.NextResponse.json({results:d,amount:a.amount,currency:a.currency,transactionType:a.transactionType,timestamp:new Date().toISOString()})}catch(e){return console.error("Error calculating fees:",e),i.NextResponse.json({error:"Failed to calculate fees"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/calculate/route",pathname:"/api/calculate",filename:"route",bundlePath:"app/api/calculate/route"},resolvedPagePath:"/workspace/escrow-compare/app/api/calculate/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:v}=m,h="/api/calculate/route";function f(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},83493:(e,t,a)=>{a.d(t,{_:()=>n});let r=require("@prisma/client"),n=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972,67],()=>a(72955));module.exports=r})();